â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    AZDOIT ENHANCEMENT - API CONTRACTS                    â•‘
â•‘                        PR #156 Enhancement Design                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ DELIVERABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“„ Documentation (7,761 lines total)
   â”œâ”€â”€ API_CONTRACTS_AZDOIT.md (2,594 lines) â­ MAIN CONTRACT
   â”œâ”€â”€ AZDOIT_ARCHITECTURE.md (634 lines)
   â”œâ”€â”€ AZDOIT_IMPLEMENTATION_GUIDE.md (1,060 lines)
   â”œâ”€â”€ AZDOIT_README.md (443 lines)
   â”œâ”€â”€ AZDOIT_CONTRACTS_SUMMARY.md (Executive Summary)
   â””â”€â”€ Security docs (3,030 lines - pre-existing)

ğŸ—ï¸ MODULE STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

src/azlin/agentic/
â”œâ”€â”€ ğŸ“˜ intent_parser.py          [EXISTS] Natural language â†’ Intent
â”œâ”€â”€ ğŸ“˜ command_executor.py       [EXISTS] Execute commands
â”‚
â”œâ”€â”€ ğŸ†• strategy_selector.py      Choose optimal strategy
â”œâ”€â”€ ğŸ†• objective_state.py        Persist objectives to JSON
â”œâ”€â”€ ğŸ†• cost_estimator.py         Estimate Azure costs
â”œâ”€â”€ ğŸ†• recovery_agent.py         Research & retry failures
â”œâ”€â”€ ğŸ†• terraform_generator.py    Generate Terraform HCL
â”œâ”€â”€ ğŸ†• mcp_client.py             Azure MCP Server client
â”œâ”€â”€ ğŸ†• mslearn_client.py         MS Learn search
â”œâ”€â”€ ğŸ†• errors.py                 Exception hierarchy
â”œâ”€â”€ ğŸ†• config.py                 Configuration management
â”‚
â””â”€â”€ strategies/
    â”œâ”€â”€ ğŸ†• base.py               Strategy interface âš¡ MAIN STUD
    â”œâ”€â”€ ğŸ†• azure_cli.py          Azure CLI execution
    â”œâ”€â”€ ğŸ†• terraform.py          Terraform execution
    â”œâ”€â”€ ğŸ†• mcp_server.py         MCP Server execution
    â””â”€â”€ ğŸ†• custom_code.py        Python code generation

ğŸ¯ KEY INTERFACES (The "Studs")
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ExecutionStrategy (ABC)
  â”œâ”€ can_handle(context) â†’ bool
  â”œâ”€ estimate_cost(context) â†’ float
  â”œâ”€ execute(context) â†’ ExecutionResult
  â”œâ”€ validate(result) â†’ bool
  â””â”€ rollback(result) â†’ bool

ExecutionContext (Input)
  â”œâ”€ intent: Dict[str, Any]
  â”œâ”€ parameters: Dict[str, Any]
  â”œâ”€ resource_group: Optional[str]
  â”œâ”€ dry_run: bool
  â”œâ”€ verbose: bool
  â””â”€ cost_limit: Optional[float]

ExecutionResult (Output)
  â”œâ”€ success: bool
  â”œâ”€ strategy: StrategyType
  â”œâ”€ outputs: Dict[str, Any]
  â”œâ”€ resources_created: List[str]
  â”œâ”€ cost_estimate: Optional[float]
  â”œâ”€ execution_time: float
  â””â”€ error: Optional[str]

ğŸ“Š EXECUTION FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User Request
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IntentParser   â”‚ [EXISTS] Parse natural language
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StateManager   â”‚ [NEW] Create objective record
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CostEstimator  â”‚ [NEW] Estimate cost, confirm if needed
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StrategySelectorâ”‚ [NEW] Score & select optimal strategy
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                     â†“              â†“             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Azure CLIâ”‚         â”‚Terraform â”‚   â”‚   MCP   â”‚  â”‚  Custom  â”‚
â”‚Strategy â”‚         â”‚ Strategy â”‚   â”‚ Server  â”‚  â”‚   Code   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ExecutionResultâ”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                   â”‚ Success? â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
                   NO      YES
                    â†“        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Recovery â”‚  â”‚ Return â”‚
            â”‚  Agent   â”‚  â”‚Success â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’° COST ESTIMATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CostEstimator
  â”œâ”€ estimate_intent()      General intent â†’ cost
  â”œâ”€ estimate_vm()          VM cost calculation
  â”œâ”€ estimate_storage()     Storage cost calculation
  â””â”€ estimate_terraform()   Parse HCL â†’ cost

Azure Pricing API
  â”œâ”€ VM hourly rates by size/region
  â”œâ”€ Storage monthly rates by type/region
  â””â”€ Cached pricing data

ğŸ”„ RECOVERY AGENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RecoveryAgent
  â”œâ”€ analyze_failure()      Error â†’ Recovery plan
  â”‚   â”œâ”€ Error analysis (Claude API)
  â”‚   â”œâ”€ MS Learn search
  â”‚   â””â”€ Generate recovery plan
  â”‚
  â””â”€ attempt_recovery()     Execute recovery
      â”œâ”€ retry              Try again same way
      â”œâ”€ modify_params      Change parameters
      â”œâ”€ change_strategy    Try different strategy
      â””â”€ escalate           Needs human intervention

ğŸ“ STATE PERSISTENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

~/.azlin/azdoit/state/{uuid}.json
{
  "objective_id": "uuid",
  "user_request": "create 3 VMs",
  "intent": {...},
  "status": "completed|failed|in_progress",
  "selected_strategy": "terraform",
  "execution_results": [...],
  "resources_created": ["/subscriptions/.../vms/test-1", ...],
  "total_cost": 36.50,
  "created_at": "2025-10-20T...",
  "updated_at": "2025-10-20T..."
}

âš™ï¸ CONFIGURATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

~/.azlin/azdoit/config.json
{
  "strategy_preferences": {
    "prefer_terraform": false,
    "max_cost": 100.0
  },
  "cost_estimation": {
    "enabled": true,
    "confirmation_threshold": 10.0
  },
  "recovery": {
    "enabled": true,
    "max_attempts": 3
  }
}

ğŸš¨ ERROR HIERARCHY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AzDoItError (base)
â”œâ”€â”€ IntentParseError
â”œâ”€â”€ StrategyError
â”‚   â”œâ”€â”€ NoStrategyFoundError
â”‚   â”œâ”€â”€ StrategyExecutionError
â”‚   â”œâ”€â”€ AzureCLIError
â”‚   â”œâ”€â”€ TerraformError
â”‚   â”œâ”€â”€ MCPError
â”‚   â””â”€â”€ CodeGenerationError
â”œâ”€â”€ StateError
â”‚   â””â”€â”€ ObjectiveNotFoundError
â”œâ”€â”€ CostEstimationError
â”œâ”€â”€ RecoveryError
â””â”€â”€ ValidationError

ğŸ§ª TESTING STRATEGY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Unit Tests (>80% coverage)
  â”œâ”€ test_strategy_selector.py
  â”œâ”€ test_objective_state.py
  â”œâ”€ test_cost_estimator.py
  â”œâ”€ test_recovery_agent.py
  â”œâ”€ test_terraform_generator.py
  â”œâ”€ test_mcp_client.py
  â”œâ”€ test_mslearn_client.py
  â””â”€ strategies/
      â”œâ”€ test_azure_cli.py
      â”œâ”€ test_terraform.py
      â”œâ”€ test_mcp_server.py
      â””â”€ test_custom_code.py

Integration Tests (Critical paths)
  â”œâ”€ test_end_to_end.py
  â”œâ”€ test_strategy_selection.py
  â”œâ”€ test_recovery_flow.py
  â””â”€ test_cost_estimation.py

ğŸ“… IMPLEMENTATION TIMELINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Week 1: Foundation
  âœ“ errors.py
  âœ“ strategies/base.py
  âœ“ objective_state.py

Week 2: Core Strategies
  âœ“ strategies/azure_cli.py
  âœ“ strategy_selector.py
  âœ“ strategies/terraform.py

Week 3: Supporting Services
  âœ“ terraform_generator.py
  âœ“ cost_estimator.py
  âœ“ mcp_client.py
  âœ“ mslearn_client.py

Week 4: Advanced Features
  âœ“ strategies/mcp_server.py
  âœ“ strategies/custom_code.py
  âœ“ recovery_agent.py

Week 5: Integration
  âœ“ CLI integration (cli.py)
  âœ“ config.py
  âœ“ End-to-end testing

ğŸ“ˆ METRICS & SUCCESS CRITERIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Functionality
  âœ“ All 4 strategies working
  âœ“ Strategy selection >90% accurate
  âœ“ State persistence reliable
  âœ“ Cost estimation Â±10% accuracy
  âœ“ Recovery success >50% (retryable failures)

Quality
  âœ“ >80% unit test coverage
  âœ“ All critical paths integration tested
  âœ“ Type checking passes
  âœ“ Zero security vulnerabilities

User Experience
  âœ“ Natural language works intuitively
  âœ“ Cost confirmations prevent overruns
  âœ“ Error messages actionable
  âœ“ Recovery transparent
  âœ“ Dry-run accurate

ğŸ¯ PHILOSOPHY ALIGNMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Bricks & Studs
  âœ… Self-contained modules
  âœ… Stable interfaces (ExecutionStrategy)
  âœ… Clear boundaries
  âœ… Regeneratable from contracts

Ruthless Simplicity
  âœ… Every module justified
  âœ… Minimal abstractions
  âœ… No premature optimization
  âœ… Observable results

Quality Over Speed
  âœ… Full type hints
  âœ… Comprehensive tests
  âœ… Real implementations (no stubs)
  âœ… Error handling complete

ğŸ“Š ESTIMATED EFFORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Code:          2,500-3,000 LOC
Tests:         2,000 LOC
Documentation: 7,761 lines (complete)
Timeline:      5 weeks
Risk:          Low (independently testable)
Impact:        High (10+ new capabilities)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Status: âœ… Design Complete - Ready for Review
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
